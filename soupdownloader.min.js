var fs=require("fs"),lazy=require("lazy"),async=require("async");var count=0,countsearch=0,stream=fs.createReadStream("./soup_falk_2013-01-03.rss");var parralelDLs=2;
function downloader(a,d){var c=a.line.toString("utf8").match("<soup:attributes>(.*?)</soup:attributes>");if(c!=null){var b=JSON.parse(c[1]);if("url" in b){setTimeout(function(){console.log("LINE: "+b.url);
d();},1000);}else{d();}}else{d();}}var q=async.queue(function(a,b){console.log("hello "+a.id);downloader(a,b);},parralelDLs);function processRssLine(a){count++;
q.push({id:count.toString(),line:a},function(b){if(b){console.log("ERROR in Queue: ",b.message);}});}q.empty=function(){console.log("NEW BATCH");stream.resume();
};new lazy(stream).lines.forEach(function(a){stream.pause();processRssLine(a.toString());});